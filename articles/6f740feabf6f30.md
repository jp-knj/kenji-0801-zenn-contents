---
title: "どうして統合テストは重要なんだろう？"
emoji: "🌊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [frontend, javascript, typescript, test]
published: false
---
## はじめに
最近では、多様なテスト手法や開発者向けツールを散見します。

エンドツーエンド（E2E）テストだけでも、「Cypress」「Puppeteer」「Playwright」「Selenium」などのツールがあります。
さらに単体テストだけでも「Jest」「Vitest」や「Visual Studio」のビルトイン単体テスト機能など、テストの準備を容易に自動化できます。

ですが、多様なテストツールを導入しても、「When」、「How」を押さえてなければ、テストの効果を有効に得ることができないと考えています。
まず、静的テスト、単体テスト、統合テスト、E2Eテストを実装コスト/時間と信頼性の観点で見ていき、無駄や漏れのないテスト戦略を立てていきましょう 。

## テストを実装コスト/時間と信頼性で考える
どのテストを使用するかの選択する観点として、テストをする実行時間／実装コストと、テスト結果の信頼性のトレードオフが存在します。

### 静的テスト/ Static Test
実装コスト: 少しある / 信頼性: 少しある
静的テストは、基礎的な`linting`（プログラミング言語の文法の間違いやエラーを指摘する）や静的解析であり、誤字脱字などの基礎的な問題を見つけるのに役立ちます。
静的テストは最も手軽に、かつ素早く実行できるテストです。ですが、このテストの結果で保証されるは、アプリケーション全体の品質に関しては高い効果は得られないと考えます。。

### 単体テスト/ Unit Test
実装コスト: 少しある / 信頼性: 少しある
単体テストは、ライブラリのテストに最適だと考えています。それはより小さなロジックやデータ処理に焦点を当てるので、条件付きロジックや関数呼び出しのように、特定の入力セットと出力セットが対応していることを確認するテストになるからです。

### 統合テスト
実装コスト: 高い / 信頼性: 高い 
統合テストでは、バックエンドサービス間やフロントエンドフレームワークのコンポーネント間など、サービス／コンポーネント間の相互作用をテストします。

このテストは、コンポーネントが連携して正しく動作することを確認するために必要になります。単体テストでは、各コンポーネントが正しく動作することが分かるかもしれないが、データエラーやロジックエラーは、コンポーネントを分離してテストしたときにのみ現れるかもしれません。
統合テストでは、テストの実行プロセスをより軽量化できるので、より低コストで実施できます。

統合テストに力を入れるべき理由は後述させていただきます。

### E2Eテスト
実装コスト: とても高い / 信頼性: とても高い

E2Eテストでは、ユーザーがアプリケーションでアクションを実行しようとするときに遭遇し得る品質問題を想定し、アプリケーションのユーザー体験全体をテストする。一般的に、最も時間と費用がかかるが、「ユーザーはアプリケーションに不備を感じないだろう」という確信が得られる。
E2Eテストはより高性能なサーバを必要とし、完了までに時間がかかるので、コストもかかる。
E2Eテストに非常に長い時間がかかる一因は、バックエンドサーバに対して呼び出しすることにある。これによって多くのことが分かるが、厄介な事態に陥ることもある。E2Eテストが失敗した場合、フロントエンドコードのせいではなく、バックエンドに問題がある可能性があるからだ。

## なぜ、統合テストは重要なのだろうか
Remix.runのケント・C.・ドッズ氏や、Vercelのギレルモ・ラウチ氏などの著名なソフトウェアエンジニアは、統合テストがE2Eテストよりも低コストで、単体テストよりもカバー範囲が広いことを理由に、もっと統合テストを重視するように提唱している。

ドッズ氏は自身の見解を説明するために、マーティン・ファウラー氏の「テストピラミッド」のアップデート版「テストトロフィー」を作成した。

ファウラー氏のテストピラミッドはよく知られている。コストが上がるとテストのスピードが落ちる傾向があることを示しており、そのために多くの開発者がE2Eテストを最小限に抑え、単体テストを最も多用する。一方、テストトロフィーは少し分かりにくいので、ドッズ氏がどのように説明しているかを紹介する。

「一般的な考え方は、静的解析ツールと統合テストによって、かけたコストに対して“素晴らしい”価値が得られるというものだ。そして単体テストとE2Eテストによって、“良い”価値が得られる。全て利用していただきたい」

統合テストの大きな価値の一つは、E2Eテストと同じようにユーザーの行動をテストできることにある。ユーザーがコンポーネントを単独で使用することはほとんどなく、ほとんどのソフトウェアは、異なるコンポーネント間の相互作用として実行される。このため、統合テストは、特定のロジックの入力と出力をテストするだけの単体テストと比べて、テスト結果の信頼性が高くなる。

ただし、これはもちろん、よく書かれた統合テストにのみ当てはまる。

## 良いテストの条件ってなんだろう
統合テストが良いかどうかを決める条件の一つは、できる限りモックアウトをしないことだ。その目的は、テストするアプリケーション機能の量を最大化することにある。

これは、一般的なテストのやり方とは異なる。テスト経験のほとんどが単体テストである開発者にとっては、特にそうだ。フロントエンド開発における従来のやり方の顕著な例として、「シャロー（浅い）レンダリング」テストを作成する傾向が挙げられる。

シャローレンダリングテストでは、画面上の複数要素による相互作用ではなく、単一のコンポーネントをテストする。だが、これは悪い慣行になりがちだ。これでは複数のコンポーネント間の統合に関する問題を捉えられないからだ。

現在では、テストフレームワーク全体の一部として統合テストを重視するトレンドがある。このトレンドはしばらく続きそうだ。それにはもっともな理由がある。ドッズ氏の次の言葉がそれを物語っている。

「統合テストは、信頼性とスピード／コストを素晴らしく両立させている。このため、大部分の労力をそこに費やすことが推奨される」

包括的なテスト戦略では、4種類のテストを組み合わせて使用する。だが、統合テストの費用対価値に勝るものはない。