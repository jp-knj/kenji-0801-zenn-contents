---
title: "Import On Interaction"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
ユーザーがリソースを必要とするUIを操作したときに、重要でないリソースを遅延ロードする。

ページには、すぐに必要でないコンポーネントやリソースのコードやデータが含まれていることがあります。例えば、ページの一部をクリックしたりスクロールしたりしない限り、ユーザーが目にすることのないユーザーインターフェースの一部などです。これは、あなたがオーサリングした多くの種類のファーストパーティコードに適用できますが、ビデオプレーヤーやチャットウィジェットなどのサードパーティウィジェットにも適用され、通常、ボタンをクリックしてメインインターフェイスを表示する必要があります。

これらのリソースを熱心に (つまりすぐに) ロードすると、コストがかかる場合はメインスレッドをブロックし、ユーザーがページの重要な部分とやり取りできるまでの時間を短縮することができます。これは、First Input Delay、Total Blocking Time、Time to Interactiveなどのインタラクション・レディネス・メトリクスに影響を与える可能性があります。これらのリソースをすぐにロードするのではなく、次のような、より適切なタイミングでロードすることができます。

ユーザーがそのコンポーネントを初めて操作するためにクリックしたとき
コンポーネントをスクロールして表示する
または、ブラウザがアイドルになるまでそのコンポーネントのロードを延期する（requestIdleCallbackを使用）。
リソースをロードするさまざまな方法は、高レベルで、次のとおりです。

Eager - リソースをすぐにロードする（スクリプトの通常のロード方法）。
Lazy (ルートベース) - ユーザーがルートまたはコンポーネントに移動したときにロードされます。
Lazy (On interaction) - ユーザーが UI をクリックしたときにロードされます (例: チャットの表示)。
Lazy (In viewport) - ユーザーがコンポーネントに向かってスクロールしたときにロードされます。
プリフェッチ - 必要になる前にロードし、重要なリソースがロードされた後にロードする。
プリロード - 切望して、より緊急性の高いもの
注：ファーストパーティーコードのインポートオンインタラクションは、インタラクションの前にリソースをプリフェッチできない場合にのみ実行すべきです。しかし、このパターンはサードパーティのコードに非常に適しており、一般に、重要でない場合は後の時点に延期することになります。これはさまざまな方法で実現できます（インタラクションが発生するまで、ブラウザがアイドル状態になるまで、またはその他のヒューリスティックを使用して延期します）。
インタラクション時に機能コードを遅延してインポートすることは、この投稿で取り上げる多くの文脈で使用されるパターンです。Google Docsでは、ユーザーとのインタラクションがあるまでロードを延期することで、共有機能のための500KBのスクリプトのロードを節約しています。

