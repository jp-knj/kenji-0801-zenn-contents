---
title: "【Module Bundler】パフォーマンスチューニングに役立つBundle Splitting"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['javascript', 'typescript', 'webpack', 'rollup', 'code splitting']
published: false
---

# はじめに
Webpack や Rollup などのバンドラーは、最新の Web アプリケーションを構築する際に、アプリケーションのソースコードを取得し、これを 1 つまたは複数のバンドルにまとめます。ユーザーが Web サイトにアクセスすると、ユーザーの画面にデータを表示するために、バンドルが要求されて読み込まれます。

V8などのJavaScriptエンジンは、ユーザーから要求されたデータを解析してコンパイルしながら読み込むことができる。最近のブラウザは、できるだけ速く、性能よく解析・コンパイルできるように進化していますが、開発者が担当するのは、リクエストされたデータの読み込み時間と実行時間の2段階を最適化することなのです。メインスレッドがブロックされないように、実行時間をできるだけ短くすることを心がけたいものです。

最近のブラウザはバンドルが到着するとストリーミングできるようになっていますが、それでもユーザーの端末に最初のピクセルが描かれるまでにかなりの時間がかかることがあります。バンドルが大きければ大きいほど、エンジンが最初のレンダリング呼び出しが行われた行に到達するまでに時間がかかる可能性があります。それまでは、ユーザーはしばらく真っ白な画面を見つめることになり、非常にフラストレーションが溜まります。

私たちは、できるだけ早くユーザーにデータを表示したいと願っています。バンドルが大きいと、読み込み時間、処理時間、実行時間が長くなります。このバンドルのサイズを小さくして、高速化できれば最高です。

不要なコードを含む巨大なバンドル1つを要求する代わりに、バンドルは複数の小さなバンドルに分割することができます

## バンドル分割 がある？
アプリケーションをバンドル分割することで、バンドルの読み込み、処理、実行にかかる時間を短縮することができるのです! 読み込みと実行の時間を短縮することで、ユーザーの画面に最初のコンテンツが描画されるまでの時間（First Contentful Paint）と、最大のコンポーネントが画面にレンダリングされるまでの時間（Largest Contentful Paint）を短縮することができるのです。

画面にデータが表示されることは素晴らしいことですが、私たちはコンテンツだけを見たいわけではありません。アプリケーションとして完全に機能させるためには、ユーザーがアプリケーションと対話できるようにしたいのです。UI がインタラクティブになるのは、バンドルが読み込まれ、実行された後です。すべてのコンテンツが画面に描かれ、インタラクティブになるまでにかかる時間をTime To Interactiveと呼びます。

バンドルが大きければ大きいほど、実行時間が長くなるとは限りません。ユーザーが使わないようなコードを大量に読み込んでしまうこともあり得ます。バンドル内のある部分は、ユーザーが行うかどうかわからない、特定のユーザーインタラクションのときにのみ実行されるかもしれません。

ユーザーが画面に何かを表示する前に、エンジンはまだ、最初のレンダリングで使用されないコードをロード、解析、コンパイルする必要があります。解析とコンパイルのコストは、ブラウザがこれらの 2 つのステップを処理する性能の高い方法によって実質的に無視できますが、必要以上に大きなバンドルをフェッチすると、アプリケーションのパフォーマンスが低下します。ローエンドのデバイスや低速のネットワークのユーザーは、バンドルをフェッチする前に読み込み時間が大幅に増加することがわかります。

エンジンがファイルの最後の部分しか使用しないにもかかわらず、最初の部分はまだ読み込まれて処理されなければなりません。 現在のナビゲーションで高い優先度を持たないコードの部分を最初に要求する代わりに、このコードを最初のページをレンダリングするために必要なコードから分離することができます。

大きなバンドルを main.bundle.js と emoji-picker.bundle.js という 2 つの小さなバンドルにバンドル分割し、より少ない量のデータをフェッチすることで、最初の読み込み時間を短縮しているのです。

## さいごに
このプロジェクトでは、アプリケーションを複数の小さなバンドルに分割し、最も効率的でパフォーマンスの高い方法でリソースをロードするためのメソッドをいくつか紹介します。