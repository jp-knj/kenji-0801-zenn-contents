---
title: "UI に影響を与えるすべての状態"
emoji: "😸"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

## はじめに
UI is a function of state. という言葉は、Reactの創設者である Dan Abramov によって広められました。

https://overreacted.io/the-two-reacts/

https://overreacted.io/how-are-function-components-different-from-classes/

私はその話題をもう少し掘り下げて、UIに影響を与えれるすべての状態を探ることにしました。

## アプリケーションの State
状態は一様ではなく、さまざまな階層で存在します。
私たちはトップから始めて詳しく見ていきます…

### グローバルな State
- ストア
  - アプリケーション全体の状態を管理する
    - Redux, Zustand, Jotai
  - ブラウザーのストア
    - localStorage, sessionStorage, IndexedDB, cookies
- データ
  - アクセス操作データ
    - 認証トークン, 位置情報 
    - ユーザー情報
    - セッション

#### ページ・コンポーネントの State
ページやコンポーネントが存在する可能性のあるすべての状態を非常によくまとめています。

空の状態
ローディング
なし
単一
複数
コンテンツが多すぎる
エラー
成功
完了

#### カスタム状態
あなたのアプリケーションに関連する任意の特注またはカスタム状態

#### リアルタイムマルチプレイヤーイベントメッセージ
チャットアプリやリアルタイム株価ティッカーの常時更新される状態を想像してください。コンポーネントレベルで保存されるか、グローバル状態に投げ込まれます。

#### スクロール位置
ページやコンポーネントは、ビューポート内外にスクロールされているかどうかを知る必要がしばしばあります。

私の経験では、ページと各コンポーネントはこれらの状態のいくつかの混合を含み、グローバル状態の変化に反応することがあります。

#### 要素の状態
個々の要素は（そしてなる）自身の状態を持ちます。この層では、HTML、CSS、ARIAの特徴が明らかになり始めます。

#### カーソル状態
default、pointer、wait、text、move、grab、crosshair、zoom-in、zoom-out、など

#### カスタムカーソル
IntersectionObserverEntry
isIntersecting = true、false

#### スタッキングコンテキスト
z-index

#### レイヤー
Root
- ::backdrop

Top
- 属性状態 - HTMLで反映される状態
- Visibility = hidden、visible
- Language = dir、lang
- Functionality = contenteditable、draggable、invoketarget
- Display = inert、open、popover
- Loading = lazy、eager
- 疑似クラス状態 - CSSで反映される状態
- Action = :hover、:active、:focus、:focus-visible、:focus-within
- Input = :autofill、:checked、:disabled、:valid、:invalid、:user-valid、:user-invalid、:required、など。
- Display = :fullscreen、:modal、:picture-in-picture
- Language = :dir()、:lang()
- Location = :link、:visited、:target、など。
- Resource = :playing、:paused
- CustomStateSet = ウェブコンポーネント用のカスタム状態
など

- ARIA状態 - ARIAで反映されるユーザー向け状態 
  - aria-current 
  - aria-expanded 
  - aria-pressed 
  - aria-hidden

### デバイスの状態
アプリケーションのユーザーやそのデバイス、周辺機器、ブラウザは、最終的なアプリケーションのレンダリング方法に大きな影響を与えます。これは設計によるもので、ウェブの基盤に組み込まれています。

#### 言語とローカリゼーション
驚き！全てのユーザーがUS-West-2に住んでいるわけではありません。

- テキストの方向 = ltr、rtl
- 書き込みモード = horizontal-tb、vertical-lr、vertical-rl
- サーバー/CDNまでの距離（レイテンシー）
- 自動翻訳
- 単語が長い（例：ドイツ語）
- 単語が短い（例：中国語）

#### デバイスの制約
ユーザーのデバイスには多くのバリエーションとカスタマイズがあり、ガラスへのレンダリングにおける最大の未知のボトルネックになるかもしれません。

- ネットワーク接続 = ファイバー、ケーブル、Wi-Fi、5G、4G、3G、"lie-fi"
- ビューポート = 高さ、幅、初期スケール、水平ビューポートセグメント、垂直ビューポートセグメント、ビューポートセグメント幅、ビューポートセグメント高さ、など。
- 環境定数 = safe-area-inset-*、titlebar-area-*、keyboard-inset-*（例：iPhoneのノッチ、丸みを帯びた角、インストールされたアプリ）
- ピクセル密度 = 1x、2x（Retina）、3x、など。
- 低電力モード
- 画面の明るさ
- CPU速度
- GPU/dGPU
- L1/L2/L3キャッシュ
- CPU/GPU/メモリ競合（例：他のアプリが開いている）
- カラーガムットサポート = Rec2020、P3、sRGB、など
- キーボード = 組み込み、外付け、T9、仮想オンスクリーン、タッチバー、など
- XRサポート = インライン、イマーシブVR、イマーシブAR

#### モダリティ
ユーザーはデバイスとのやり取り方法が一様ではなく、同時に複数の入力や出力を使用している場合があります。

#### 入力
- マウス = ワンボタン、ツーボタン、マウスホイール、トラックボール、タッチパッド、高/低DPI
- キーボード = 100%、60%、10キー、querty、colemak、エルゴノミック、分割、機械式、など
- タッチ/タップ = 粗いポインター、ホバーなし
- スタイラス = 細いポインター、ホバー、圧力感度
- ジェスチャ = ピンチズーム、2/3/4本指スワイプ
- モーション = 加速、シェイクトゥアンドゥ、バンプ、など
- オリエンテーション = ランドスケープ、ポートレート、アルファ/ベータ/ガンマ（それぞれ360º/180º/90º）回

## ブラウザの State
最後に、ユーザーのブラウザ選択と好みのプラグインは、ユーザーがあなたのUIやアプリケーションをどのように体験するか（または体験したいと望むか）に大きく影響します。そして、あなたのアプリケーションはこれらの好みのいくつかに応答することができます。

### ユーザーの好み
- prefers-color-scheme = light, dark, forced-colors 
- prefers-reduced-motion = reduce, no-preference 
- prefers-reduced-transparency = reduce, no-preference 
- ユーザーズーム = 100%から400% 
- テキストサイズ = smallからx-largeまで

### 機能と機能性
- ブラウザバージョン = 最新版、最後の2バージョン、古いもの
- フィーチャー検出 = @supportまたはポリフィル
- カラーガムットサポート = Rec2020, P3, sRGB, など
- ブラウザキャッシュヒット
- サービスワーカーヒット
- ディスプレイモード = fullscreen | standalone | minimal-ui | browser
- beforeinstallprompt
- プリントモード
- リーダーモード
- JavaScript無効 = はい、実際にこれを行う人を知っています。
- スリーピングタブ

### 許可
- カメラ = true, false
- マイクロフォン = true, false
- ジオロケーション = 許可されている、許可されていない、アプリ使用中のみ
- 通知 = true, false
- ファイルアクセス = true, false

### プラグイン
広告ブロッカー - UBlock, Safari ITP, Ghostery, など
カスタムプラグイン/ブースト

## ユーザーの状態
これまで技術について話してきましたが、今度は取引のもう一方の端にいる実際の人間について考えてみましょう。
ユーザーの肉体的または精神的な状態は、あなたの提供する体験を楽しむための認知的または文字通りの帯域幅に影響を与えます。

- 緊急事態/危機が発生している
- 認知障害
- 恒久的または一時的に障害がある
- 「スプーンがない」
- 屋内または屋外
- 飛行機や電車の中
- 都市部または森林内

## サードパーティサービスの状態
サードパーティはUIのユーザーエクスペリエンスに大きな影響を与えます。

### 利用可能性/ステータス
他のサーバーのステータス/利用可能性/稼働時間は、UIの最大の障害面です。

- サーバーハードウェアステータス = オンライン、オフライン、部分的に利用可能
- データベースステータス = オンライン、オフライン、トランザクションロック
- APIステータス = オンライン、オフライン、部分的に利用可能
- ウェブフォントサービス = オンライン、オフライン、部分的に利用可能
- DNSステータス = 解決まで最大72時間かかる場合があります
- パッケージ依存関係 = 動作中、壊れている、悪意のある注入、プロテストウェアなど
- アセット配信およびキャッシングステータス
  - Cloudflare
  - S3

#### スクリプト注入
サードパーティのスクリプト注入は、UIのパフォーマンス劣化に最も大きく寄与しています。一部のサービスはアプリケーションのユーザーエクスペリエンスを乗っ取ることさえあります。これはしばしばあなたのコントロール外です。

- アナリティクス/トラッキングサービス 
- ユーザーセッション記録サービス 
- A/Bテスト注入 
- インストラクショナルオーバーレイ 
- アクセシビリティオーバーレイ 
- サードパーティ認証（OAuth）サービス 
- キャプチャ/検証サービス

これらのチェックされていないサービスのいずれかがアプリケーションをダウンさせるまで、本当に人生を経験したことはありません。

### UIは単なる状態以上のものがあります...
私は状態の全カテゴリーを忘れてしまったかもしれません。私はCSSの数百のプロパティや数千の値とそれらの潜在的な衝突についてさえ触れていません。フォームコントロールのスタイリングの複雑さや、必要なARIAプロパティの組み合わせでドロップダウンを構築することについて話していません。ページに画像を配置するために必要な決定行列に触れていません。また、正しい順序で頭の中の適切なタグを設定することについても触れていません。これはSEOのためのマイクロフォーマットや、UIを適切に設定してアナリティクスデータを送信するために必要なすべてのコードについても議論していません。

最後に、UIが得意な人を雇いましょう。


