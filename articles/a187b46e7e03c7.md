---
title: "JavaScriptのエラーと友達になる方法"
emoji: "🦁"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---
## はじめに
プログラミングの世界にも当てはまります。アプリケーション作りに、バグやその他の問題の発生はつきもの。JavaScriptでエラーが発生するのは、何も不思議なことではありません。
このような問題を、ユーザーに迷惑をかける前に、いかに解決できるか。これこそが、ソフトウェア製品の成功を左右します。

JavaScriptでWebフロントエンドを開発していると、一度はデータ型でエラーを発生したことがあるのではないでしょうか。undefined や null の扱いでミスを発生するのはよくあることでしょう。

この記事では、JavaScript のエラーについて解説した後、エラーの発生箇所を特定する方法や解決する手法を共有していきます。
実務での運用で効率的にエラーを処理するため Tips もあります。

## そもそもエラーとはなんだろう
Webアプリケーション開発におけるエラーとは、プログラムが正常に動作していない状況のことです。

具体的な例として、
- 存在しないファイルを読み込もうする: `Module not found: Error: Can't resolve ～`
- ネットワークに接続されていない状況でWebサイトにアクセスしする : `net::ERR_INTERNET_DISCONNECTED`

上記の場合だと、プログラムが正常に指示された動作を行うことができない状況です。

このような状況に遭遇するとプログラムは開発者に対しエラーを投げ、「そのプログラムだと問題が発生する」と伝えます。
エラーが発生した原因の情報が収集され、表示してくれるのです。

ですが、WebアプリケーションのユーザーがWebb開発がよく見るようなエラーを読むことがないように、対処するのは大切でしょう。
わかりやすいメッセージとして「ページが見つかりませんでした」などが表示します。

具体例として、
![スクリーンショット 2022-11-05 21 02 39](https://user-images.githubusercontent.com/70939128/200119038-80a5b044-d1ef-4efe-94c6-9ec9b6b7fad5.png)

そして、プログラミング言語である JavaScript のエラーとは、エラーが発生した時に表示されるオブジェクトのことです。
そのオブジェクトには、以下の情報があります。
- エラーの種類
- エラーの原因（ステートメント/statement）
- スタックトレースに関する情報

`extends` を使用して、エラーを拡張させることもできます。これによって、プログラミングの問題を調査する時に表示される情報量を増やすことができます。


### エラーのプロパティ(インスタンスプロパティ)について
JavaScriptのより詳細を解説していきます。
エラーは主に3つから成り立っています。
- Message: 人間が読めるエラーの簡潔な説明
- Name: エラーの種類の名称で初期値は "Error"
- Stack: エラーは発生するまでに呼び出しされたメソッドのスタックトレース

#### スタックトレースとはなんだろう
スタックトレースとは、例外や警告などのイベントが発生したときに、直前にプログラムが実行していたメソッドを一覧で示したものです。

スタックトレースは主に３つから成り立っています。
  - 問題が発生する前の最後のステップ
  - エラーの型とメッセージ
  - ファイルのパス, 行番号、カラム数

具体例として、
```sh
$ node demo.js

/Users/jp-knj/Desktop/demo.js:10
  notDefined();
  ^
RerefenceError: notDefined is not defined 
    at thirdFunction (/Users/jp-knj/Desktop/demo.js:10:3)
    at secondFunction (/Users/jp-knj/Desktop/demo.js:6:3)
    at firstFunction (/Users/jp-knj/Desktop/demo.js:2:3)
    // 以下 省略
```


エラー名とメッセージとして `RerefenceError: notDefined is not defined` が表示されます。
その後に呼び出されたメソッドの一覧が表示されます。 各メソッド呼び出しには、ファイルのパス、、行番号、カラム数を確認できます。
上記のスタックトレースをより詳細に解説すると
```shell
at thirdFunction              // 呼び出された各メソッド
/Users/jp-knj/Desktop/demo.js // ファイルのパス
~/demo.js:10:3                // ファイル名、行番号、カラム数 
```
表示された情報を元に `code jump` して、どのコードがエラーの原因であるかを特定するのができるのです。

このメソッドは、処理の順序を反映するかたちで表示されます。これにより、例外が発生した箇所と、それがどのように伝搬していったのかを確認できるのです。

例外の `catch` を実装すれば、例外がスタックを伝搬しプログラムをクラッシュさせてしまうことはありません。 しかし、致命的なエラーをそのままにし、意図的にプログラムをクラッシュさせるケースも考えられます。

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Error/Stack

### エラーと例外の大事な違いについて
私自身、エラーと例外との違いを曖昧にしていた開発者です。ですが、大事な違いがありますので理解しておきましょう。
- エラーとは、プログラムが正常に動作していない状況のこと
- 例外とは、投げられたエラーオブジェクトのこと

具体的な例として、
```javascript
const demoError = TypeError('Hello', "someFile.js", 10)

throw demoError 
```

`demoErrorrオブジェクト`が例外です。

業務で使用する場合は、糖衣構文で使っていることが多いのではないでしょうか
```javascript
throw TypeError('Hello', "someFile.js", 10)
```
https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/TypeError

## JavaScript にはどんなエラーがあるのだろう

JavaScriptには、定義されたさまざまなエラーのタイプがあります。 これは、Webアプリケーションで明示的にエラーの処理を行い限り、JavaScriptランタイムによって自動的に選択、定義されます。

JavaScriptで主なエラーのタイプ、各タイプはいつ、どのような理由で発生するのかを解説していきます。

#### TypeError
このエラーのタイプはよく開発者も多いのではないでしょうか。
変数や引数の型が想定された型でないことが検出されたときに表示されます。

具体例として
```javascript
TypeError: Object doesn't support property or method {x} (Edge)
TypeError: "x" is not a function
```
関数でないものを、関数呼び出ししようとしたときに発生するエラーです。
特定の関数が定義されていることを想定しているが、定義されていないときも発生するでしょう。

https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Errors/Not_a_function

#### ReferenceError
コード内の変数の参照に問題があるときに表示されます。
変数を使用する前に値を定義するのを忘れたか、またはコードでアクセスできない変数を使用しようとしている可能性があります。
いずれにしても、スタックトレースを確認することで、問題のある変数の参照を見つけ、修正にあたることができます。

具体例として
```javascript
ReferenceError: "x" is not defined
```
変数は現在の実行コンテキストで利用可能である必要があります。関数の中で定義された変数は、その関数のスコープ内でしか定義されていないので、関数の外のどこからもアクセスできません。

#### RangeError
変数に有効な値の範囲外にある値が設定されたときに表示されます。
関数に引数として値を渡すときに発生し、与えられた値が関数のパラメータの範囲内にないことを示します。正しい値を渡すためには、引数に取り得る値の範囲を知る必要があるため、サードパーティのライブラリのドキュメントが不十分な場合、このエラーの解決には手間がかかる可能性があります。

```javascript
RangeError: Invalid array length
```

a.length(配列の要素の数)を負の数にして、対応している値を超えてしまった

Arrayコンストラクタで不正な長さの配列を作成しようとした
toExponential()、toPrecision()、toFixed()などのメソッドに不正な値を渡した

#### SyntaxError
修正するのが最も簡単なものエラーです。JavaScriptはスクリプト言語ですので、スクリプトにあるエラーがあると、実行時に、このようなエラーが返されます。
コンパイル言語では、このようなエラーはコンパイル時に発見されます。したがって、エラーが解決されるまで、アプリケーションのバイナリを生成することはないでしょう。

```javascript
SyntaxError: expected expression, got "x"
```

eslint を使って、発見しましょう


#### InternalError
InternalErrorは、JavaScriptのランタイムエンジンで例外が発生したときに表示されます。
これはコードの問題を意味することも、そうでないこともあります。
```javascript
RangeError: Maximum call stack size exceeded
```

具体例として、関数の呼び出しが多すぎるときに表示されます。

JavaScriptエンジンにとって大きすぎるエンティティがコード内に存在する（例：switch文のcaseの分岐が多すぎる、配列初期化子が大きすぎる、再帰が多すぎる）

JavaScriptエンジンの作業負荷が急激に上昇してしまうのを避けましょう。

#### URIError
URIErrorは、decodeURIComponentのようなグローバルなURI処理関数が間違った方法で使用されたときに表示されます。
メソッド呼び出しに渡されたパラメータがURI標準に準拠しておらず、メソッドによって適切にパースされなかったことを意味します。
```javascript
URIError: URI malformed
```

引数に問題がないかを調べるだけで対処できるので簡単です。

#### EvalError
EvalErrorは、eval()関数の呼び出しで問題が発生したことを意味します。eval()関数は、文字列に格納されたJavaScriptコードを実行するのに使用されます。しかし、eval()関数の使用はセキュリティ上の問題から推奨されておらず、現在のECMAScriptの仕様ではEvalErrorクラスは返されないため、このエラーはあくまでも古いJavaScriptコードとの後方互換性を維持するために存在しています。

古いバージョンのJavaScriptで作業していると、このエラーに遭遇する可能性があります。いずれにせよ、eval()関数の呼び出しで実行されたコードに例外がないかどうか調査するのが得策です。


### エラーをカスタマイズしよう！


## エラーのあるある


## エラーを特定しよう！


## エラーを解決しよう！


## さいごに