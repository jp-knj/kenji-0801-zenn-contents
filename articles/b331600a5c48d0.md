---
title: "CSSをメンテナブルにするstylelint入門"
emoji: "🌊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [css, stylelint, prettier, eslint, accessibility, design]
published: false
---
# はじめに
CSSに怒りや苛立ちを覚えた方も少なくはないのではないでしょうか。
ですが、CSSの品質管理ツールをどのように活用するのか議論が少ない印象を持っております。
`Vue CLI`や`Create React App` などのフロントエンド開発ツールには ESLintの設定が含まれていますが、CSS の linter は含まれてはないのです。
そこで、**stylelint** を使って、エラーを検知、フォーマットの一貫性やスタイリングの重複を防ぐこと方法や特徴について解説します。

この記事は、**stylelint** の使い方やあまり知られていないルールやプラグインついても紹介します。

## styelintとは？
stylelintの公式ドキュメントから引用すると
> A mighty, modern linter that helps you avoid errors and enforce conventions in your styles.

チーム全体で使うCSSのスタイルを回避し、コードの一貫性を高めるために役立つ linter です。 
スタイルのエラーを自動的に修正してくれ、使用したいルールだけを有効にし、好みに合わせて設定することができます。

styelint はモダンなCSS構文を理解し、解析してくれます。
HTML、 Markdown、CSS in JS objects、Template literals などのさまざまな形式のCSSにも対応しています。
[エディタ](https://stylelint.io/user-guide/integrations/editor/) や [タスクランナー](https://stylelint.io/user-guide/integrations/task-runner) 、[pre-commit](https://github.com/thibaudcolas/pre-commit-stylelint) 、webpackにもプラグインがあるので、共有しやすいです。

### stylelintでできること
stylelintを初めて利用する方は、stylelintのコアメンバーである David Clark が執筆した [こちら](https://css-tricks.com/stylelint/) を参照するのを薦めます。

主に３つほど要点を挙げます
- エラーを検知する
- ベストプラクティスを提供する
- コーディングルールを徹底する

#### エラーを検知する
CSSの syntax error を検知することができます。
テキストエディタでも補完やハイライトをしてますが、styelintでも検知するとチームでミスを発見する必要性は限りなく少なくなるでしょう。

具体例として
`color-no-invalid-hex`ルールと`property-no-unknown`を有効にすると
以下の syntax error を検知してくれます。
```css
.class {
 color: #EAE2AE1; /* invalid hex color */
 with: 100px;     /* unknown property  */
}
```

#### コーデイング規約を徹底する
stylelintは、コードのスタイル規則を自動的に強制する多くのルールを備えているので、あなたやあなたのチームメイトは、そのようなルールを強制される必要はありません。私たちは、これらのルールを非常に包括的かつ非常に柔軟にすることを心がけました。

これらのルールは主にホワイトスペースに関するものですが、引用符や文字の大文字小文字、分数の先頭のゼロ、キーワードの使用と値のスペルアウトなど、他の細かい点も対象にしています。

夢は、あなたとあなたのチームメイトが一度フォーマット規約を確立し（例えば「宣言のコロンの後には常に半角スペースを入れよう！」）、stylelintの設定にそれを成文化し、その後二度とそれについて話すことがないようにすることです。強制は機械帝国に任せればいいのです。

#### ベストプラクティスを提供する
スタイルシートに体系的な手法を用いたり、コードのスタイルガイドを用意したりすれば、特定のパターンを決定的に禁止することができるはずです。stylelintはそのための手段を提供します。

何よりも、セレクタを制御する必要があります。冷酷に。stylelint を使用すると、ある特定の範囲を超えるセレクタを無効にしたり、ネストの深さに上限を設定したりすることができます。セレクタのカテゴリを禁止したり（例：idセレクタの禁止）、正規表現を使用して残りのセレクタの命名規則を強制することができます。

importantの使用を禁止したり、サポートしているブラウザに適用されないブラウザハックを禁止することができます。Autoprefixer を使っている場合 (おそらく使うべきです)、ソーススタイルシートでのベンダープレフィックスの使用を禁止することができます。
Stylelint は埋め込まれたスタイルを抽出することができます。

## styelint を使ってみる
まず、npm を使って Stylelint をインストールし、コアとなるルールセットを有効にするために stylelint-config-standard も一緒にインストールします。Stylelint-config-standardは、idiomatic CSS principlesやAirbnbのスタイルガイドなど、一握りのCSSスタイルガイドに共通するスタイル上の慣習をベースにしています。

```shell
$ npm install --save-dev --save-exact stylelint stylelint-config-standard
```

プロジェクトのルートに設定ファイルを作成します。
```shell
$ touch .stylelintrc.json
```
または
```shell
$ touch .stylelintrc
```
```json:example
{
  "extends": "stylelint-config-standard"
}
```
これでコマンドラインからStylintを実行できるようになりました。例えば、プロジェクト内のCSSファイルのみを対象とする場合は、stylelint "**/*.css" と実行します。エラーを自動的に修正するには、-fixフラグを追加してください。
Stylelintに慣れるために、標準的なルールに目を通しておくとよいでしょう。空白の設定から始めて、必要なルールだけを追加することを提唱する人もいれば、標準の設定をベースにして、経験を積むにつれて修正していく人もいます。

後者は確かに一番手っ取り早い方法です。最初は自動修正をオフにして、よく発生するエラーを見て理解できるようにするのがいいと思います。ある程度理解できたら、自動修正をオンにしてください。もちろん、あなた次第です!

## stylelint のオススメな設定

### 可読性を高めてくれる.プロパティを並び替えるプラグイン
stylelint-order プラグインは、プロパティを自動的に好きな順番に並べ替えることができます。これにより、CSSコードを読みやすく、理解しやすくすることができます。以下のように、保存するたびにプロパティをソートしておくと便利です。


ただし、プロジェクトでこれを自動化するのは注意が必要だ。やみくもにやると、いろいろと壊れてしまうかもしれないからだ。そのため、Prettierでは機能として搭載していない。Sassでの@mixinと@includeの使用は、注意したい部分の一つです。プロパティは現在のブロックの外からインクルードされるため、既存の宣言の順序を変更すると、そのルールの計算スタイルが変更される可能性があります。

アルファベットの順序付けは、人々が従う唯一の順序付けパターンではありません。さらに2つの例があります。

ジョナサン・スヌークのSMACSS
Anton Korzunov の stylelint-semantic-groups です。
慣用的なCSSスタイルガイドには、いつ、どれを使うかについてのアドバイスがあります。

### アクセシビリティを高めてくれるプラグイン
stylelint-a11y プラグインは、アクセシビリティを開発プロセスの中でより重要な部分とするのに役立ちます。これは素晴らしいことだと思います。アクセシビリティは重要な関心事であるべきで、後回しにするべきではありません。

このプラグインは、以下のルールを追加します。

他のプロパティと値の組み合わせで使用すると無視されるプロパティがあることをご存知でしょうか？

### CSSの誤解を防ぐプラグイン
たとえば、display: inlineを使用した場合、widthなどのサイズプロパティは無視されます。これは、あなたにとって明白な例かもしれませんが、他のものはあまり明白ではありません。明らかであろうとなかろうと、これらは忙しいプロジェクトの中で忘れてしまったり、見逃してしまったりするものなのですリンターがこれらをキャッチしてくれるようにしてはどうでしょうか。

stylelint-declaration-block-no-ignored-properties プラグインを使用すると、これらをリンターで検出することができます

## 具体的な使用例
### Prettier と stylelintを併用して使う
Prettierはコードの書式を管理するために非常によく使われています。Stylelintはいくつかの書式規則をエラーとして報告するため、Prettierと衝突することがあります。Prettierがある特定の方法で書式を設定すると、Stylelintはそれを好まないのです。

stylelint-config-prettierを設定に含めることで、衝突する規則を無効にすることができます。この設定は、ルールが上書きされないように、extendsの中で常に最後に参照される設定であるべきです。