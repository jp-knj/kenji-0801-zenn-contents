# ACT テスト設計について
Web アクセシビリティは、すべてのユーザーがウェブコンテンツを等しく利用できるようにするための重要な側面です。この記事では、ACT ルールについての詳細を解説します。
Web アクセシビリティの標準である WCAG 2.x とそのサポートドキュメントを基に、WCAG-ACT-RULES-CG のルール設計が構築されています。この記事では、ACT Rules Format 1.0 に基づくアプローチについて説明します。

## ACTルールとは
ACT ルールは、WCAG や WAI-ARIA などのアクセシビリティ標準の適合性をテストする方法を説明しています。これにより、アクセシビリティのテスターは、手動テストや自動テストツールや他のテスティング方法論と一貫した方法でエッジケースを評価する方法を知ることができます。

### ACTルールの目的
ACT ルールは、WCAG や他のアクセシビリティガイダンスのエッジケースのテスト方法を調和させるために設計されています。各 ACT ルールは、WCAG の成功基準や他の要件の特定の側面をテストする方法を技術固有の言語で説明しています。

- ACT ルールは情報提供のみ : ACT ルールは情報提供のみであり、適合性を決定するためには必要ありません。WCAG への適合性を決定するための基準は、WCAG 標準の成功基準です。
- ACT ルールは部分的なチェック : ACT ルールは、通常、WCAG 2 の成功基準などの特定のアクセシビリティ要件をチェックします。例えば、ACT ルールは、テーブルセルにヘッダーがあるかどうかをテストするかもしれません。
- ACT ルールは失敗をチェック : ACT ルールは、WCAG 2 の成功基準や他のアクセシビリティ要件を満たすための失敗をチェックするように設計されています。

#### 注意点
WCAG 2 の適合要件 1 は、「適合する代替バージョン」を許可しています。これは、コンテンツが ACT ルールに失敗しても、コンテンツが WCAG 2 に適合している可能性があることを意味します。

## ルール設計
WCAG-ACT-RULES-CG のルール設計は、WCAG 2.x とそのサポートドキュメントに基づいています。以下のアプローチは、ACT Rules Format 1.0 に基づいて達成することを目指しています。
- **ルールの属性**：テスト対象とその環境を定義します。識別子、名前、タイプ、説明などの他のメタデータも含まれます。
- **適用性**：ルールを使用してページ上のどの要素をテストするかを特定します。
- **期待値**：ルールを合格させるためにターゲット要素について真実でなければならないことを断言します。
- **仮定**：結果の説明責任を確保するために、ルールによって明示的に仮定されるすべてのことを明記します。
- **アクセシビリティサポート**：支援技術やユーザーエージェントの既知の機能サポートの問題に関する情報を提供します。
- **背景**：ルールの開発時に参照された関連リソースに関する情報を提供します。
- **テストケース**：実装を検証し、読者に合格、不合格、不適用の結果を示すコードの例範囲を定義します。
- **用語集**：ルールファイル内で使用される定義済みの用語のリスト。

### ACTルール テストケース設計
ACT ルールのテストケースの目的は、実装者が自らの実装が ACT ルールと一致していることを確認することを可能にすることです。それは、ルールがその"重要な"側面すべてにテストケースを持っていることを要求します。それを超えて、テストケースのリストをどれだけ広範にするかは、ルールの著者が決定することです。テストするエッジケースの決定は、実世界の例の問題に基づいて行われるべきです。

テストケースの良いバランスを取るために、以下の原則を考慮する必要があります。

1. ルールのすべての"条件"をテストする
2. 一度に 1 つのことをテストする
3. アクセシビリティとの一貫性を確保する
4. テストケースを小さく保つ
5. 定義を表面的にテストする
6. アクセシビリティサポートによって争われるテストケースを避ける
7. これらすべてに例外があることを念頭に置く

#### すべての条件をテストする
最低限、適用可能性と期待におけるすべての"条件"には、それに対する肯定的および否定的なテストケースが必要です。例えば、"img と svg の要素"というフレーズには、"img の要素"と"svg の要素"の 2 つの条件が含まれています。このようなフレーズを適用可能性に持つルールは、次のテストケースを必要とします：

- ルールに合格する img
- ルールに合格する svg
- ルールに合格しない img
- ルールに合格しない svg
- 適用できない他の要素

これらのテストケースを提供することで、img 要素を正しくテストする実装者が、すべての svg 要素をパスする場合、部分的な実装として識別され、すべての svg 要素が失敗する場合は、一貫性のない実装として識別されることを保証します。

#### 一度に一つのことをテストする
テストケースは、一度に 1 つの"条件"だけをテストする必要があります。これにより、それらを集中的にし、理解しやすくなります。複数のケースを 1 つの例に組み合わせることは魅力的かもしれませんが、その例が期待される結果を得られない場合、問題の原因を特定するのが難しくなります。

テストケースを書くとき、条件付きのロジックを見ることが重要です。例えば、適用可能性が要素が"可視で、アクセシビリティツリーに含まれている"場合、合格と失敗の例に加えて、これが真ではない 3 つの方法があり、それらすべてがテストされる必要があります：

- 適用できない： 可視だが、アクセシビリティツリーには含まれていない
- 適用できない： 不可視だが、アクセシビリティツリーには含まれている
- 適用できない： 不可視で、アクセシビリティツリーにも含まれていない

#### アクセシビリティ要件との一貫性
実装のマッピングが動作するためには、テストケースはアクセシビリティ要件と一貫している必要があります。これは、合格および適用できないテストケースが、ルールのアクセシビリティ要件、およびこのルールが設計された任意のコンポジットルールのアクセシビリティ要件を満たしていることを要求します。アクセシビリティ要件を満たさない適用できない条件は含められるべきではありません。例えば、2.4.2 ページのタイトルをテストする場合、タイトルが記述的であるというルールは、タイトルが必要であるが持っていないページの適用できない例を持っていることはできません。

これに関連して、失敗したテストケースは、1 つの理由だけでアクセシビリティ要件に違反している必要があります。4.1.2 名前、役割、値の失敗したテストケースは、アクセシブルな名前と役割の両方に問題があってはなりません。もしルールがアクセシブルな名前に関するものであれば、役割と値は正しくなければなりません。

適用可能性と合格の結果の間には実装のマッピングにほとんど違いがないため、"見た目が悪い"が実際にはアクセシビリティ要件を満足している適用できないテストケースを持つ方がよく、ツールが適用可能性を正しく実装していない場合、このテストケースに失敗します。例えば、1.4.3 コントラスト（最小）をテストする場合、ルールは無効なボタンに適用できない可能性があります（これは成功基準の第二の例外に一致するため）；この条件の適用できないテストケースは、その背景とのコントラスト比が 2.0:1 の無効なボタンを含む場合が、コントラスト比が 5.0:1 の無効なボタンを含む場合よりも優れています（この第二のケースでは、ツールが無効なボタンを無視しない場合、テストケースに合格し、ルールの正しい実装を主張できます）。Applicability の部分をテストする場合、"見た目が悪い"適用できない例を持つことは常に可能ではありません。

#### 小さなテストケース
テスト設計の一般的な原則は、テストケースを小さく保つことです。不要なコンテンツは避けてください。それは結果に予期しない副作用を引き起こす可能性があります。例えば、ボタンに関するルールでは、すべてのテストケースに lang 属性と title 要素を持つ HTML 要素が必要なわけではありません。これらの要素はボタンのアクセシビリティに影響しません。テストケースのすべてのコードは、ルールまたはそのアクセシビリティ要件に関連している必要があります。

その例外として、ACT ルールは良好なアクセシビリティの慣行を示すよう努力すべきです。autocomplete 属性が有効であるというルールは、autocomplete 属性を持つフォームコントロールのラベルを提供する必要があります。これらのラベルは、入力の意図された目的を示すコンテキストを提供するとともに、フォームコントロールにラベルを提供する良い慣行を示しています。

#### 表面的な定義のテスト
ACT ルールは、重複を避け、詳細を"隠す"ために定義を使用します。"セマンティックロール"、"可視"、"アクセシブルな名前"などの定義は、多くのルールで使用され、ACT の基本的な構築要素です。特定の定義を使用するすべてのルールで多くの類似したテストケースを持つことを避けるために、定義のテストを最小限に抑えるのが最善です。

例として、"X には空でないアクセシブルな名前がある"というルールはすべて、要素がアクセシブルな名前を持つことができる異なる方法をチェックするテストケースを持っています。img の場合、それは alt、title、および aria-label(ledby)属性です。これは、基本が理解されていることを確保するのに十分なカバレッジを作成します。しかし、これらのルールは、アクセシブルな名前の計算が正しく行われていることを確保するための詳細には入らない。実装者がアクセシブルな名前の計算で aria-owns を考慮するかどうかは、"空でないアクセシブルな名前"のルールに関連していません。

それは、定義のエッジケースには決してテストケースがないと言うことではありません。特定のエッジケースがルールの結果に影響する実世界の例がある場合、そのエッジケースをカバーするためにルールにテストケースが追加されるべきです。

#### (アクセシビリティ)サポートの問題を避ける
ルールには、完全にサポートされていない技術を関与させることがかなり一般的です。例えば、ARIA の役割は数年ごとに追加され、新しい役割が支援技術によって採用されるのにはしばらく時間がかかります。特定の技術がほとんどまたは全くサポートされていない場合、ルールはこのためのテストケースを持っているべきではありません。

特定の技術に対するサポートが十分にある場合、テストケースを検討すべきです。部分的にサポートされている技術を導入する最良の方法は、それらに対して失敗したテストケースを提供することのみです。これにより、この技術をサポートしていない実装が部分的に一貫していることが確認されます。

広くサポートされている技術は、すべてのテストケースで使用できます。すべての状況で、テストケースが必要かどうかを決定する前の原則は、まだ適用されます。

#### 例外
すべてのこれらの原則に例外があることを知っておくことが重要です。特定のテストケースを含めない技術的な理由があるかもしれません、または組み合わせの数が不合理な数のテストを必要とするかもしれません。合格したテストケースがすべてのアクセシビリティ要件を満たしていることが論理的に意味をなさない場合があるかもしれません。一部の定義にはテストが不要であるかもしれません、他のものは広範なテストが必要であると主張できます。など。

実際の例が一貫性を前進させるための駆動力となることも意味します。ルールの著者は、すべての考えられる状況のテストケースを書くことに困ってはならない。ルールの著者は、初版での実装者間の 95%の一貫性を目指すべきです。このパーセンテージは測定する必要はありません、これは目指すべきもののアイデアを提供することを意図しています。より多くの例が発見されるにつれて、この数字は時間とともに上がります。