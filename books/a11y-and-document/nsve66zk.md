---
title: "QA：アクセシビリティの評価"
---
## Accessibility Conformance Testing 
Web アクセシビリティの重要性は高まっていますが、具体的にどのようにそれを確保するかは、多くの開発者にとって未知の領域ではないでしょうか。この記事では、ACT(Accessibility Conformance Testing)を中心に、効率的なアクセシビリティテストの進め方を解説します。

### ACT とは
アクセシビリティ適合性試験（Accessibility Conformance Testing）の略です。
WCAG は Web アクセシビリティのガイドラインとして広く知られていますが、具体的なテスト方法までが記載されているわけではありません。ここで ACT ルールが役立ちます。このルールは、特に WCAG で明確に触れられていないエッジケースを中心に、アクセシビリティの適合性を確認するための方法を提供しています。

#### ツールとの関係性について
様々な Web アクセシビリティテストツールが存在します。Web アクセシビリティツールを利用することで効率的に問題を見つけることができるようになるでしょう。
ですが、ツールだけに頼るのは危険です。例えば、画像の代替テキスト（alt 属性）は、内容が適切かどうかをツールだけで判断するのは難しいです。ページの文脈によっては、同じ画像でも異なる代替テキストが適切なときも考えられます。

ACT ルールの役割[^1]は、テスト方法を手動テストや自動テストに分け、それぞれのテストの標準を定めています。これにより、一貫性のあるアクセシビリティ評価を目指しています。

- **基準の明示** ： ACT ルールは、WCAG や WAI-ARIA のようなアクセシビリティ基準にどのように合致しているか、または合致していないかを明確にするための具体的なテストケースを示します。
- **手動・自動テストの一貫性** ： ACT ルールは、手動でのテスト方法と自動テストツールが示す結果が一貫していることを保証するための基準となります。これにより、テスターはどのような方法を用いても、同じ基準でテストができるという利点があります。
- **エッジケースの取り扱い** ： Web ページやアプリケーションは複雑で、常に予期しない状況やエッジケースが発生します。ACT ルールは、これらのエッジケースにおいても、どのようにアクセシビリティを評価すればよいかを示す指針を提供します。

完璧なスコアをツールで得たとしても、完璧な Web ページとは限りません。ACT ルールを取り入れることで、よりユーザーのためにアクセシビリティ向上を実現する手助けを得られるでしょう。

## ACTルールの目的
#### 情報提供の役割 
ACT ルールは、WCAG への適合性を判断するための基礎ではなく、むしろ参考情報としての位置づけです。 W3C の ACT ルール（List of ACT Rules for WCAG 2）[^2] は、W3C の AGWG[^3] によってレビューされています。しかし、このリストは WCAG 標準ほど詳細に精査されているわけではありません。そのため、ACT ルールだけを完全に信頼するのではなく、WCAG 標準と併用して利用することが推奨されます。

#### 全てではなく、部分的なチェックの実施
ACT ルールは、WCAG 達成基準の一部分をチェックしています。

あるページには多数のテーブルが配置されており、それぞれが異なる情報を提示しています。一部のテーブルは、商品データを示しており、ヘッダーセルが各列や行のデータを説明しています。ACT ルールにあるテーブルのヘッダーセルとデータセルの関連付け[^4]は、このヘッダーセルが正しく配置されているか、そして適切に機能しているかを評価します。

このルールは WCAG 達成基準 1.3.1「情報及び関係性」(コンテンツの情報や構造が、ソフトウェアによって正確に認識できるようにすること）を全体的に評価するものではありません。

:::details テーブルのヘッダーセルとデータセルの関連付けについて 
HTML の `<th>`要素（ヘッダーセル）と `<td>`要素（データセル）を使用します。`<thead>`要素、`<tbody>`要素、`<th scope="col">`要素や属性を組み合わせることで、ヘッダーセルとデータセルの関連を明確に示すことができます。これにより、スクリーンリーダーは、どのヘッダーセルがどのデータセルと関連しているのかを理解できます。
```html:example.html
<table>
    <thead>
        <tr>
            <th scope="col">商品名</th>
            <th scope="col">価格</th>
            <th scope="col">在庫数</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>りんご</td>
            <td>¥100</td>
            <td>50</td>
        </tr>
        <tr>
            <td>バナナ</td>
            <td>¥80</td>
            <td>30</td>
        </tr>
    </tbody>
</table>
```
:::

WCAG 2.2 の達成基準は、技術的な制約を受けずに設計されています。ですが、ACT ルールは、特定の技術や実装に特化しています。このため、全ての Web 技術やコンテンツタイプに適用可能なわけではありません。

#### 失敗の特定
ACT ルールは、WCAG 達成基準のどの部分が満たしていないかどうかを確認することも 1 つの目的になります。

あるページには複数のリンクが存在します。ACT ルールの 1 つは、これらのリンクがキーボード操作だけでアクセス可能かどうかをチェックします。リンクがキーボード操作でアクセスできないとき、このルールは「失敗」ということになるでしょう。

##### 合格と失敗の意味
コンテンツが ACT ルールに合格したとき、それは該当の失敗が検出されなかったということですが、すべての達成基準を満たしているわけではありません。ACT ルールの主な目的は、アクセシビリティ要件の不適合な部分、すなわち「失敗」を特定することです。

キーボード操作のルールに合格したとき、ページ上のリンクはキーボードでアクセス可能です。しかし、それは他のアクセシビリティの達成基準、例えばリンクのテキストが意味のあるテキストかどうか、に関しては何も保証しません。

適合性の確認には、他の ACT ルールや人間による詳細な検証が必要です。

### ルール設計
このルールは、Web ページのアクセシビリティを向上させるための一助となることを目的としています。具体的なコンテンツやコンテキストに応じて、詳細なテストや評価が必要となるときがあります。注意してください。

WCAG-ACT-RULES-CG のルール設計は、WCAG 2.x とそのサポートドキュメントに基づいています。
- **ルールの属性**：テスト対象とその環境を定義します。識別子、名前、タイプ、説明などの他のメタデータも含まれます。
- **適用性**：ルールを使用してページ上のどの要素をテストするかを特定します。
- **期待値**：ルールを合格させるためにターゲット要素について真実でなければならないことを断言します。
- **仮定**：結果の説明責任を確保するために、ルールによって明示的に仮定されるすべてのことを明記します。
- **アクセシビリティサポート**：支援技術やユーザーエージェントの既知の機能サポートの問題に関する情報を提供します。
- **背景**：ルールの開発時に参照された関連リソースに関する情報を提供します。
- **テストケース**：実装を検証し、読者に合格、不合格、不適用の結果を示すコードの例範囲を定義します。
- **用語集**：ルールファイル内で使用される定義済みの用語のリスト。

:::details 具体例として <image> 要素のアクセシビリティテスト
#### ルールの属性
- **ID**: ACT-RULE-001-IMG
- **名前**: `<image>`要素のアクセシビリティ評価
- **タイプ**: 自動
- **説明**: このルールは、Web ページに含まれる `<image>` タグがアクセシビリティ基準を遵守しているかを評価します

#### 適用性
- HTML の `<image>` タグがページに存在する場合。

#### 期待値
- すべての `<image>` タグには `alt` 属性が存在し、適切な代替テキストが提供されていること。

#### 仮定
- 画像は視覚的なコンテンツとして情報を提供する目的で使用されている。
- テキスト以外のメディア（音声やビデオなど）が `<image>` タグの代替として使用されていない。

#### アクセシビリティサポート
- ほとんどのブラウザや支援技術は `alt` 属性をサポートしています。

#### 背景
- WCAG 2.x の達成基準 1.1.1（非テキストコンテンツ）

#### テストケース

##### 合格例
```html
<image src="flower.jpg" alt="赤い花のクローズアップ">
```

##### 不合格例
```html
<image src="flower.jpg">
```

##### 不適用例
```html
<div style="background-image: url('flower.jpg');"></div>
```
```html
<image src="flower.jpg" alt="">
```

#### 用語集
- **`<image>` タグ**: HTML で画像を埋め込むためのタグ。
- **`alt` 属性**: 画像の内容をテキスト形式で説明するための属性。
:::
---

## ACTルールでのテストケース設計
#### テストケースの目的
ACT ルールのテストケースは、実装者が自らの実装が正確であること、つまりアクセシビリティ基準やガイドラインに合致していることを確認するのに役立ちます。実際の Web ページやアプリケーションにおいて、多様な状況や条件が考えられるため、それらのシチュエーションにおいても ACT ルールが正確に機能することが求められます。

#### テストケースの範囲
一方で、どの程度のテストケースを用意するか、その範囲をどこまで広げるかは、ルールの策定者の判断に委ねられます。エッジケースの選定や優先順位付けは、実際の Web ページやアプリケーションでの具体的な問題点や挙動に基づいて行うべきです。

テストケースの良いバランスを取るために、以下の原則を考慮する必要があります。

- **条件を網羅する**： ルールのすべての条件に対応するテストケースを持つことは基本です。しかし、不足している場面や冗長なテストが存在することも。これを改善するためには、定期的なレビューとアップデートが必要です。
- **単一の目的を持つテストケース**： テストケースは、一度に 1 つの条件のみをテストすべきです。これにより、テスト結果の解析が容易になり、問題の特定も簡単になります。
- **小さいテストケース**： 実際の Web ページやアプリケーションでの具体的な問題や挙動を基に、エッジケースを洗い出し、それに基づいてテストケースを作成することが必要です。
- **定義の簡素化**： ACT ルールは、重複を避け、詳細を隠すための定義です。しかし、これらの定義は時に曖昧になることが。定義を常に明確にし、それに基づいたテストケースを作成することが求められます。
- **アクセシビリティサポートの課題**： 一部の技術や要件が完全にサポートされていない場面があるため、それに対応するテストケースは慎重に取り扱う必要があります。
- **例外の考慮**： すべての原則やテストケースには例外が存在する可能性があります。これらの例外を明示的に記述し、それに対応するテストケースを追加することで、網羅性を高めることができます。

#### 条件を網羅する
Web ページ上にさまざまな要素が存在します。特定の要素がアクセシビリティ基準を満たしているかどうかを確認するための「ルール」が必要です。このとき、img 要素と svg 要素に焦点を当てて説明します。

###### img 要素のテストケース
- **合格するケース** : ある写真があり、その写真には `alt="猫がボールで遊んでいる写真` という属性がついています。この `alt` 属性は、画像の内容をテキストとして説明しているため、スクリーンリーダーのユーザーにとって役立ちます。
- **失敗するケース** : ある写真がありますが、`alt`属性が欠けている、または `alt=""` と空である場合。これでは、スクリーンリーダーのユーザーにとって、画像の内容を知る手段がありません。

###### svg 要素のテストケース
- **合格するケース** : アイコンとしての`svg` 要素があり、それには `role="img" aria-label="検索アイコン"` という属性がついています。これにより、この SVG が画像としての役割を持ち、検索アイコンであることが示されています。
- **失敗するケース** : `svg` 要素がありますが、`role` 属性や `aria-label` 属性のようなアクセシビリティ属性が設定されていないときです。スクリーンリーダーはこの SVG の意味や役割を理解できません。

###### ルールの対象外
`div` や `span` のような要素は、通常、`img` や `svg` のような視覚的なコンテンツを表すものではないため、上記のルールの対象外です。

これらのテストケースを提供することで、実装者は自らの実装が正しく、一貫性があり、期待通りに動作するかを確認できます。特に、異なる要素に対するテストケースを明確に分けることで、実装の精度や一貫性を向上させることが期待されます。

#### 単一の目的を持つテストケース
テストケースは、一度に 1 つの条件だけをテストする必要があります。これにより、該当の条件を理解しやすくなります。複数のケースを 1 つの例に組み合わせるのは魅力的です。しかし、その例が期待される結果を得られない場合、問題の原因を特定するのが難しくなります。

条件付きのロジックに焦点を当てることで、テストケースはより包括的で詳細になります。

「要素は目に見えて、スクリーンリーダーも読み上げる（アクセシビリティツリーがある）」という条件に基づいたテストケースを考えてみましょう。

**合格するケース**
- 要素は目に見えて、スクリーンリーダーも読み上げる。 
  - 例： ページ上のボタン。私たちが見ることができ、スクリーンリーダーもそのボタンの情報を読み上げる。

**失敗するケース**
- 目に見えるが、スクリーンリーダーは読み上げない
  - 例： デザインのためのアイコン。私たちは見ることができるが、スクリーンリーダーは無視する。
- 目に見えないが、スクリーンリーダーは読み上げる
  - 例： 非表示の説明文。私たちは見ることができないが、スクリーンリーダーは情報を提供する。
- 目に見えないし、スクリーンリーダーも読み上げない
  - 例： 非表示の非活性なボタン。私たちも見ることができず、スクリーンリーダーも無視する。

:::details アクセシビリティツリー（Accessibility Tree）とは

アクセシビリティツリー（Accessibility Tree）は、画面上のユーザーインターフェイス要素をスクリーンリーダーやその他の支援技術が理解しやすい形で表現した階層構造のデータです。このツリーは、DOM（Document Object Model）ツリーとは異なるものであり、画面上で表示される要素のアクセシビリティ情報だけを抽出して構築されます。

アクセシビリティツリーは、各要素の名前、役割、状態、プロパティなどの情報を保持します。これにより、スクリーンリーダーは、Web ページのコンテンツを適切に解釈し、視覚障害を持つユーザーに対して意味のある情報を音声として伝えることができます。

### 具体例
1. **Webページの構造**
    - HTML の DOM ツリー
      ```html
      <div>
        <h1>タイトル</h1>
        <button>クリックしてください</button>
      </div>
      ```
    - アクセシビリティツリー
      ```
      - role: group
        - role: heading, name: "タイトル"
        - role: button, name: "クリックしてください"
      ```

2. **隠された要素**
    - HTML の DOM ツリー
      ```html
      <div style="display: none;">
        私は見えないテキストです。
      </div>
      ```
    - アクセシビリティツリー
     （この`div`要素はアクセシビリティツリーに含まれません）

3. **ARIA属性を使用した要素**
    - HTML の DOM ツリー
      ```html
      <div role="button" aria-label="クリックして情報を表示">詳細</div>
      ```
    - アクセシビリティツリー:
      ```
      - role: button, name: "クリックして情報を表示"
      ```

このように、アクセシビリティツリーは、Web ページの要素のセマンティクスや関連情報を保持しており、支援技術がその情報を適切にユーザーに伝えるための中間層として機能します。
:::

#### アクセシビリティ要件との一貫性
どの要素が要件の対象であり、どの要素が対象外であるかを正確に理解することが重要です。これにより、Web ページのアクセシビリティを正確に評価し、必要な修正を行うことができます。

##### タイトルが記述的であるについて
Web ページにはタイトルが必要です。タイトルはページの内容を正確に示すものでなければなりません。

**適用できないテストケースの例**
対象のページにはタイトルがありませんでした。"タイトルが記述的である"という要件に焦点を当てるテストケースでは使用できません。なぜなら、そもそもタイトルが存在しないからです。
テストの対象外であることを示しておきましょう。

**失敗したテストケースの例**
ページにはタイトルがありますが、それは「ページ 1」とだけ書かれています。
このタイトルはページの内容を正確に示していないため、"記述的なタイトル"という要件に違反しています。

重要なのは、失敗した理由が 1 つだけであることを確認することです。例えば、あるページが 2 つのアクセシビリティ要件、例えば「名前」と「役割」の両方に違反している場合、それらの違反は個別にテストされるべきです。

##### ボタンのコントラスト比について
Web ページ上のテキストと背景の間の色のコントラストは、視覚障害のあるユーザーや高齢者などのユーザーがコンテンツを読むのを助けるために役立ちます。しかし、すべての要素が同じコントラスト要件を満たす必要はありません。

**無効化されたボタンの事例**
ボタンは、ユーザーが特定のアクションを実行するためのものです。しかし、一部のボタンは、特定の条件下で「無効化」されることがあります。たとえば、フォームのすべての必須フィールドが未入力の場合、送信ボタンが無効化されることが考えられます。

- **適用できないテストケース**:
無効化されたボタンは、アクションを示すものではないため、色のコントラスト要件の対象外とすることが多いです。具体的には、無効化されたボタンのテキストと背景色のコントラスト比が 2.0:1 であっても、それは許容される場合があります。

**コントラスト要件の適用**
ツールやガイドラインを使用して Web ページをチェックする際、無効化されたボタンは色のコントラスト要件のチェックから自動的に除外されるべきです。これは、このボタンがユーザーアクションの対象ではないため、色のコントラストが低いことによる利用の障壁がないからです。


#### 小さなテストケース
テスト設計の一般的な原則は、テストケースを小さく保つことです。不要なコンテンツは避けてください。それは結果に予期しない副作用を引き起こす可能性があります。例えば、ボタンに関するルールでは、すべてのテストケースに lang 属性と title 要素を持つ HTML 要素が必要なわけではありません。これらの要素はボタンのアクセシビリティに影響しません。テストケースのすべてのコードは、ルールまたはそのアクセシビリティ要件に関連している必要があります。

その例外として、ACT ルールは良好なアクセシビリティの慣行を示すよう努力すべきです。autocomplete 属性が有効であるというルールは、autocomplete 属性を持つフォームコントロールのラベルを提供する必要があります。これらのラベルは、入力の意図された目的を示すコンテキストを提供するとともに、フォームコントロールにラベルを提供する良い慣行を示しています。

#### 定義の簡素化
ACT ルールでの定義は、ルールをシンプルに保ち、詳細を一般的なレベルで説明するためのものです。これにより、多数のルールで共通の基本概念を使用して、テストの重複や冗長性を避けることができます。

**事例**
アクセシブルな名前 [^5]についてです。この定義は多くのルールで使われる基本的な概念です。Web ページ上の要素がどのように名前付けされるかを説明します。

要素（例： ボタンや画像）には「アクセシブルな名前」というものがあります。これは、スクリーンリーダーなどの支援技術が読み上げる名前のことを指します。この名前は、要素の属性から取得されたり、生成されます。


ボタン（button 要素）があります。このボタンに名前を付ける方法がいくつかあります。例えば、ボタンの中のテキスト、`aria-label` 属性、または `aria-labelledby` 属性を使用できます。
```html
<button aria-label="クローズ">X</button>
```

このボタンには「X」というテキストが表示されていますが、`aria-label`という属性を使って「クローズ」というアクセシブルな名前が与えられています。スクリーンリーダーはこのボタンを「クローズボタン」として読み上げます。

ここで、"has non-empty accessible name"に関連するルール[^6]の目的は、このボタンがアクセシブルな名前を持っているか（この場合は「クローズ」）を確認することです。

少し工夫した実装をしてみましょう。

```html
<span id="label1">プロフィール</span>
<button aria-labelledby="label1">編集</button>
```

ここでは、ボタンは直接的に「編集」というテキストを持っています。しかし、`aria-labelledby`属性を使って、別の要素（この場合は`span`）のテキストをボタンのアクセシブルな名前の一部として使用しています。結果として、スクリーンリーダーはこのボタンを「プロフィール編集ボタン」として読み上げる可能性があります。

しかし、"空でないアクセシブルな名前"というルールは、ボタンがアクセシブルな名前を持っているかどうかだけを確認します。名前が`aria-labelledby`を使用してどのように生成されるか、または他の属性や方法を使用して名前がどのように取得されるかの詳細は、このルールの範囲外になります。

このように、ACT ルールの中では、テストの対象や範囲を明確にするためのものであり、具体的な実装や詳細についての考慮からは離れたものとなります。

#### アクセシビリティサポートの問題を避ける
アクセシビリティサポートに関して注意が必要です。具体的には ARIA（Accessible Rich Internet Applications）の新しい `role` が導入されることがあります。しかし、新しい `role` が発表された直後は、一部のスクリーンリーダーが正しく認識しない可能性があります。

そのため、テストケースを作成する際に、まだ広くサポートされていない新しい技術や属性に関連するケースを避けることが推奨されます。それに対して、既に広くサポートされている技術や属性については、テストケースを自由に使用できます。

簡単に言うと、技術がどれだけアクセシビリティサポートされているかに基づいて、それに関連するテストケースの取り扱いを考慮する必要があります。

#### 例外の考慮
すべての原則には例外が存在します。例えば、特定のシチュエーションでのテストケースを書くことが技術的に難しい、または非現実的な場合もあるでしょう。また、あるテストケースが全てのアクセシビリティ要件を満たすことが実際的に不可能だと感じる場合もあります。

実際の具体的な例は、ルールの一貫性やその適用の明確さを向上させる手助けとなります。ルールの制作者としては、可能な限り多くのシチュエーションでのテストケースを考慮し、そのルールが異なる環境でも 95%の一貫性を持つことを目指すべきです。この「95%」は厳密な数値というより、ガイドラインとしての目標を示すものです。そして、時間と共に、更なる例やケースが発見され、この一貫性は向上することでしょう。

[^1]:[WCAG 達成基準のテストルールを理解する](https://waic.jp/translations/WCAG21/Understanding/understanding-act-rules) を参考しています。
[^2]:[All ACT Rules](https://www.w3.org/WAI/standards-guidelines/act/rules/)
[^3]:[Accessibility Guidelines Working Group](https://www.w3.org/WAI/GL/)
[^4]:All ACT Rules にある[Headers attribute specified on a cell refers to cells in the same table element](https://www.w3.org/WAI/standards-guidelines/act/rules/a25f45/) について
[^5]:[アクセシビリティツリーについて](https://developer.mozilla.org/ja/docs/Glossary/Accessibility_tree)
[^6]:[アクセシブルな名前](https://waic.jp/translations/WCAG21/Techniques/general/G208)について
[^7]:[Button has non-empty accessible name](https://www.w3.org/WAI/standards-guidelines/act/rules/97a4e1/), [Image button has non-empty accessible name](https://www.w3.org/WAI/standards-guidelines/act/rules/59796f/) などのルール。 

https://act-rules.github.io/pages/design/test-cases/
https://act-rules.github.io/pages/design/rule-design/
https://www.w3.org/TR/act-rules-format/